<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot Test Page - KheyaMind AI</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            padding: 50px 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .test-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 10px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
        }
        
        .status.loading {
            background: rgba(255, 193, 7, 0.2);
            border: 2px solid #ffc107;
        }
        
        .status.success {
            background: rgba(40, 167, 69, 0.2);
            border: 2px solid #28a745;
        }
        
        .status.error {
            background: rgba(220, 53, 69, 0.2);
            border: 2px solid #dc3545;
        }
        
        .back-btn {
            display: inline-block;
            background: #FFB703;
            color: #003049;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background: #003049;
            color: #FFB703;
            transform: translateY(-2px);
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: left;
            font-family: monospace;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Chatbot Test Page</h1>
        <p>This page tests the AnythingLLM chatbot integration</p>
        
        <div class="test-info">
            <h2>Test Instructions:</h2>
            <ol style="text-align: left; max-width: 500px; margin: 0 auto;">
                <li>Wait for the chatbot script to load (status will update below)</li>
                <li>Look for the chatbot widget (usually appears as a floating button)</li>
                <li>Click on the chatbot widget to open the chat interface</li>
                <li>Test sending a message to verify it's working</li>
            </ol>
        </div>
        
        <div id="status" class="status loading">
            üîÑ Loading chatbot script...
        </div>
        
        <div id="debug" class="debug-info">
            <strong>Debug Information:</strong><br>
            <span id="debug-content">Initializing...</span>
        </div>
        
        <a href="/" class="back-btn">‚Üê Back to Main Site</a>
    </div>

    <!-- AnythingLLM Chatbot Widget Script -->
    <script
        data-embed-id="b905d324-b48c-403f-bd1f-298de7708007"
        data-base-api-url="https://llm.kheyamind.ai/api/embed"
        src="https://llm.kheyamind.ai/embed/anythingllm-chat-widget.min.js">
    </script>
    <!-- AnythingLLM (https://anythingllm.com) -->

    <script>
        let debugInfo = [];
        
        function updateDebug(message) {
            debugInfo.push(`${new Date().toLocaleTimeString()}: ${message}`);
            document.getElementById('debug-content').innerHTML = debugInfo.join('<br>');
        }
        
        function updateStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        // Initial debug
        updateDebug('Page loaded, checking for chatbot script...');
        
        // Check if script is loading
        const scriptEl = document.querySelector('script[data-embed-id="b905d324-b48c-403f-bd1f-298de7708007"]');
        if (scriptEl) {
            updateDebug('‚úÖ AnythingLLM script element found in DOM');
        } else {
            updateDebug('‚ùå AnythingLLM script element NOT found in DOM');
        }
        
        // Monitor for widget appearance
        let checkCount = 0;
        const maxChecks = 30; // Check for 30 seconds
        
        const checkForWidget = setInterval(() => {
            checkCount++;
            updateDebug(`Checking for widget... (${checkCount}/${maxChecks})`);
            
            // Look for various possible widget selectors
            const possibleSelectors = [
                '[data-embed-id="b905d324-b48c-403f-bd1f-298de7708007"]',
                '.anythingllm-chat-widget',
                '.anythingllm-widget',
                '[class*="anythingllm"]',
                '[id*="anythingllm"]'
            ];
            
            let widgetFound = false;
            
            for (const selector of possibleSelectors) {
                const widget = document.querySelector(selector);
                if (widget) {
                    updateDebug(`‚úÖ Widget found with selector: ${selector}`);
                    updateStatus('‚úÖ Chatbot loaded successfully! Look for the chat widget on the page.', 'success');
                    widgetFound = true;
                    clearInterval(checkForWidget);
                    break;
                }
            }
            
            if (!widgetFound && checkCount >= maxChecks) {
                updateDebug('‚ùå Widget not found after 30 seconds');
                updateStatus('‚ùå Chatbot failed to load. Check console for errors.', 'error');
                clearInterval(checkForWidget);
            }
        }, 1000);
        
        // Check for script load events
        window.addEventListener('load', () => {
            updateDebug('Window load event fired');
            
            // Check for global variables that might be created by AnythingLLM
            setTimeout(() => {
                const globals = ['AnythingLLM', 'anythingllm', 'chatWidget'];
                globals.forEach(global => {
                    if (window[global]) {
                        updateDebug(`‚úÖ Global variable found: ${global}`);
                    }
                });
            }, 2000);
        });
        
        // Monitor for any errors
        window.addEventListener('error', (e) => {
            if (e.filename && e.filename.includes('anythingllm')) {
                updateDebug(`‚ùå Script error: ${e.message}`);
                updateStatus('‚ùå Script error detected. Check network connectivity.', 'error');
            }
        });
        
        // Check network connectivity to the chatbot server
        fetch('https://llm.kheyamind.ai/api/embed')
            .then(response => {
                updateDebug(`‚úÖ Server connectivity check: ${response.status}`);
            })
            .catch(error => {
                updateDebug(`‚ùå Server connectivity failed: ${error.message}`);
                updateStatus('‚ùå Cannot connect to chatbot server', 'error');
            });
    </script>
</body>
</html>